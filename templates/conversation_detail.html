{% extends "base.html" %}

{% block head %}{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-2">Conversation {{ conversation_id }}</h2>

<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  <!-- Messages -->
  <div class="md:col-span-2 bg-gray-800 rounded p-4">
    <h3 class="font-semibold mb-2">Messages</h3>
    <div class="space-y-2">
      {% for m in messages %}
        <div class="text-sm">
          <span class="font-mono px-2 py-0.5 rounded {{ 'bg-green-700' if m.role=='user' else 'bg-yellow-700' }}">{{ m.role }}</span>
          <span class="ml-2">{{ m.content }}</span>
        </div>
      {% endfor %}
      {% if not messages %}
        <p class="text-gray-400">No messages yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- Jobs -->
  <div class="bg-gray-800 p-3 rounded space-y-2">
    <div class="text-sm font-semibold mb-1">Jobs</div>
      {% if jobs %}
        {% for j in jobs[:8] %}
          <div class="border border-gray-700 rounded p-2 text-xs">
            <div class="font-semibold">Job #{{ j.id }}</div>
            <div>Model: {{ j.model }}</div>
            <div>Status: {{ j.status }}</div>
            <div>Created: {{ j.created_at }}</div>
            <div class="mt-1">
              <a class="underline" href="{{ request.scope.root_path }}/jobs" onclick="event.preventDefault(); viewJob({{ j.id }});">
                View
              </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
    <div class="text-xs text-gray-400">No jobs yet.</div>
  {% endif %}
</div>
</div>

<!-- Reply form -->
<div class="bg-gray-800 rounded p-4 mt-6">
  <h3 class="font-semibold mb-2">Reply</h3>
  <form method="post" action="{{ request.scope.root_path }}/conversations/{{ conversation_id }}/reply" class="space-y-3">
    <div>
      <label class="block text-sm mb-1">Model</label>
      <select name="model" class="w-full p-2 bg-gray-700 rounded text-gray-100">
        {% for m in AVAILABLE_MODELS %}
          <option value="{{ m }}"
            {% if last_used_model %}
              {% if m == last_used_model %}selected{% endif %}
            {% else %}
              {% if loop.first %}selected{% endif %}
            {% endif %}
          >{{ m }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block text-sm mb-1">System Prompt (optional)</label>
      <textarea name="system_prompt"
          class="w-full bg-gray-700 p-2 rounded"
          rows="3"
          placeholder="System prompt (optional)">{{ last_system_prompt or '' }}</textarea>
    </div>
    <div>
      <label class="block text-sm mb-1">Your message</label>
      <textarea name="user_input" rows="3" required class="w-full p-2 bg-gray-700 rounded text-gray-100"></textarea>
    </div>
    <div class="flex gap-2">
      <button type="submit" class="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded font-bold">Queue Reply</button>
      <a href="{{ request.scope.root_path }}/conversations" class="px-4 py-2 rounded border border-gray-600">Back</a>
    </div>
  </form>
</div>
{% endblock %}
