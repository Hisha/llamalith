{% extends "base.html" %}

{% block head %}{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-2">Conversation {{ conversation_id }}</h2>

<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  <!-- Messages -->
  <div class="md:col-span-2 bg-gray-800 rounded p-4">
    <h3 class="font-semibold mb-2">Messages</h3>
    <div class="space-y-2">
      {% for m in messages %}
        <div class="text-sm">
          <span class="font-mono px-2 py-0.5 rounded {{ 'bg-green-700' if m.role=='user' else 'bg-yellow-700' }}">{{ m.role }}</span>
          <span class="ml-2">{{ m.content }}</span>
        </div>
      {% endfor %}
      {% if not messages %}
        <p class="text-gray-400">No messages yet.</p>
      {% endif %}
    </div>
  </div>

  <!-- Jobs -->
  <div class="bg-gray-800 rounded p-4">
    <h3 class="font-semibold mb-2">Jobs</h3>
    <div class="space-y-2">
      {% for j in jobs %}
        <div class="text-sm border border-gray-700 rounded p-2">
          <div><span class="text-gray-400">Job #</span>{{ j[0] }}</div>
          <div><span class="text-gray-400">Model:</span> {{ j[2] }}</div>
          <div><span class="text-gray-400">Status:</span> {{ j[3] }}</div>
          <div><span class="text-gray-400">Created:</span> {{ j[4] }}</div>
          {% if j[5] %}<div><span class="text-gray-400">Processed:</span> {{ j[5] }}</div>{% endif %}
        </div>
      {% endfor %}
      {% if not jobs %}
        <p class="text-gray-400">No jobs yet.</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- Reply form -->
<div class="bg-gray-800 rounded p-4 mt-6">
  <h3 class="font-semibold mb-2">Reply</h3>
  <form method="post" action="{{ request.scope.root_path }}/conversations/{{ conversation_id }}/reply" class="space-y-3">
    <div>
      <label class="block text-sm mb-1">Model</label>
      <select name="model" class="w-full p-2 bg-gray-700 rounded text-gray-100">
        <option value="mistral">Mistral</option>
        <option value="mythomax">MythoMax</option>
      </select>
    </div>
    <div>
      <label class="block text-sm mb-1">System Prompt (optional)</label>
      <textarea name="system_prompt" rows="3" class="w-full p-2 bg-gray-700 rounded text-gray-100"></textarea>
    </div>
    <div>
      <label class="block text-sm mb-1">Your message</label>
      <textarea name="user_input" rows="3" required class="w-full p-2 bg-gray-700 rounded text-gray-100"></textarea>
    </div>
    <div class="flex gap-2">
      <button type="submit" class="bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded font-bold">Queue Reply</button>
      <a href="{{ request.scope.root_path }}/conversations" class="px-4 py-2 rounded border border-gray-600">Back</a>
    </div>
  </form>
</div>
{% endblock %}
